{"ts":1340792614062,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var CloudCommander;\r\nvar CloudFunc;\r\nCloudCommander.keyBinding=(function(){   \r\n    \"use strict\";\r\n    var key_event=function(event){            \r\n            /* \r\n             * Делаем допущение что перезагружать Cloud Commander\r\n             * посетителям не придёться, в любом случае, параметр\r\n             * должен быть опциональным и должна быть возможность\r\n             * его отключить. В любом случае, кроме хакеров и \r\n             * разработчиков (при чём сомнительно, что хакерам\r\n             * это пригодиться), функция перезагрузки никому не\r\n             * нужна, поскольку загружать весь дополнительный\r\n             * контент снова (js,css) в готовой версии нет\r\n             * необходимости.\r\n             *\r\n             */             \r\n            //console.log(event.keyCode);\r\n            var lCurrentFile;\r\n            var lName;\r\n            /* если клавиши можно обрабатывать*/\r\n            if(CloudCommander.keyBinded){\r\n                /* если нажали таб:\r\n                 * переносим курсор на\r\n                 * правую панель, если\r\n                 * мы были на левой и\r\n                 * наоборот\r\n                 */\r\n                if(event.keyCode===9){\r\n                    console.log('Tab pressed');\r\n                    try{\r\n                        lCurrentFile=document.getElementsByClassName(CloudCommander.CURRENT_FILE)[0];\r\n                    }catch(error){console.log(error);}\r\n                }                \r\n                /* навигация по таблице файлов*/\r\n                /* если нажали клавишу вверх*/\r\n                else if(event.keyCode===38){\r\n                    /* получаем выдленный файл*/\r\n                    lCurrentFile=document.getElementsByClassName(CloudCommander.CURRENT_FILE);\r\n                    /* если ненайдены выделенные файлы - выходим*/\r\n                    if(lCurrentFile.length===0)return;\r\n                    lCurrentFile=lCurrentFile[0];\r\n                    /* если это строка существет и\r\n                     * если она не заголовок\r\n                     * файловой таблицы\r\n                     */\r\n                    if(lCurrentFile.previousSibling && \r\n                       lCurrentFile.previousSibling.className!=='fm_header' ){\r\n                        /* убираем выделение с текущего элемента */\r\n                        lCurrentFile.className='';\r\n                        /* и выделяем предыдущую строку*/\r\n                        lCurrentFile.previousSibling.className=CloudCommander.CURRENT_FILE;\r\n                        event.preventDefault();\r\n                    }\r\n                }\r\n                /* если нажали клавишу в низ*/\r\n                else if(event.keyCode===40){\r\n                    /* получаем выдленный файл*/\r\n                    lCurrentFile=document.getElementsByClassName(CloudCommander.CURRENT_FILE);                \r\n                    /* если ненайдены выделенные файлы - выходим*/\r\n                    if(lCurrentFile.length===0)return;\r\n                    lCurrentFile=lCurrentFile[0];\r\n                    /* если это не последняя строка */\r\n                    if(lCurrentFile.nextSibling){\r\n                        /* убираем с него выделение */\r\n                        lCurrentFile.className='';\r\n                        /* выделяем следующую строку*/\r\n                        lCurrentFile.nextSibling.className=CloudCommander.CURRENT_FILE;\r\n                        event.preventDefault();\r\n                    }\r\n                }\r\n                /* если нажали клавишу page up или Home\r\n                 * переходим к самому верхнему\r\n                 * элементу\r\n                 */\r\n                else if(/*event.keyCode===33 ||*/ event.keyCode===36){\r\n                        lCurrentFile=document.getElementsByClassName(CloudCommander.CURRENT_FILE)[0];\r\n                        /* убираем выделение с текущего файла*/\r\n                        lCurrentFile.className='';\r\n                        /* получаем первый элемент*/\r\n                        lCurrentFile.parentElement.firstElementChild\r\n                        /* пропускаем путь и заголовки столбиков*/\r\n                            .nextElementSibling.nextElementSibling\r\n                            /* выделяем верхий файл */\r\n                            .className=CloudCommander.CURRENT_FILE;\r\n                }\r\n                /* если нажали клавишу page down или End\r\n                 * выделяем последний элемент\r\n                 */\r\n                else if(/*event.keyCode===34 ||*/ event.keyCode===35){\r\n                        lCurrentFile=document.getElementsByClassName(CloudCommander.CURRENT_FILE)[0];\r\n                        /* снимаем выделение с текущего файла*/\r\n                        lCurrentFile.className='';\r\n                        /* выделяем самый нижний файл */\r\n                        lCurrentFile.parentElement.lastElementChild.className=CloudCommander.CURRENT_FILE;\r\n                }\r\n                /* если нажали Enter - открываем папку*/\r\n                else if(event.keyCode===13){\r\n                    lCurrentFile=document.getElementsByClassName(CloudCommander.CURRENT_FILE);\r\n                    /* если ненайдены выделенные файлы - выходим*/\r\n                    if(!lCurrentFile.length)return;\r\n                    lCurrentFile=lCurrentFile[0];\r\n                    /* из него достаём спан с именем файла*/\r\n                    lName=lCurrentFile.getElementsByClassName('name');\r\n                    /* если нету (что вряд ли) - выходим*/\r\n                    if(!lName)return false;\r\n                    /* достаём все ссылки*/\r\n                    var lATag=lName[0].getElementsByTagName('a');\r\n                    /* если нету - выходим */\r\n                    if(!lATag)return false;\r\n                    /* получаем ссылку на каталог,\r\n                     * что на уровень выше\r\n                     */\r\n                    /* получаем имя каталога в котором находимся*/\r\n                    var lHref;\r\n                    try{\r\n                        lHref=lCurrentFile.parentElement.getElementsByClassName('path')[0].innerText;\r\n                    }catch(error){console.log('error');}\r\n                    lHref=CloudFunc.removeLastSlash(lHref);\r\n                    var lSubstr=lHref.substr(lHref,lHref.lastIndexOf('/'));\r\n                    lHref=lHref.replace(lSubstr+'/','');\r\n                    \r\n                    /* вызываем ajaxload привязанный через changelinks\r\n                     * пробулем нажать на ссылку, если не получиться\r\n                     * (opera, ie), вызываем событие onclick,\r\n                     * которое пока не прописано у файлов\r\n                     */\r\n                     \r\n                     if(lCurrentFile.onclick)lCurrentFile.onclick(true);\r\n                     else try{\r\n                         lATag[0].click();                                                \r\n                     }\r\n                     catch(error){\r\n                         console.log(error);\r\n                     }\r\n                }\r\n                /* если нажали <ctr>+r */\r\n                else if(event.keyCode===82 &&\r\n                    event.ctrlKey){\r\n                    console.log('<ctrl>+r pressed');\r\n                    console.log('reloading page...');\r\n                    console.log('press <alt>+q to remove all key-handlers');\r\n                                    \r\n                    /* обновляем страницу, */                \r\n                    /* Загружаем содержимое каталога\r\n                     * при этом данные берём всегда из\r\n                     * сервера, а не из кэша\r\n                     * (обновляем кэш)\r\n                     */\r\n                    /* Программно нажимаем на кнопку перезагрузки \r\n                     * содержимого каталога\r\n                     */\r\n                    var lRefreshIcon=document.getElementsByClassName(CloudFunc.REFRESHICON);\r\n                    if(lRefreshIcon)lRefreshIcon=lRefreshIcon[0];\r\n                    if(lRefreshIcon){\r\n                        /* находим файл который сейчас выделен */\r\n                         lCurrentFile=document.getElementsByClassName(CloudCommander.CURRENT_FILE);\r\n                         if(lCurrentFile.length>0)lCurrentFile=lCurrentFile[0];\r\n                         /* получаем название файла*/\r\n                         var lSelectedName=lCurrentFile.getElementsByTagName('a')[0].innerText;\r\n                         /* если нашли элемент нажимаем него\r\n                          * а если не можем - нажимаем на \r\n                          * ссылку, на которую повешен eventHandler\r\n                          * onclick\r\n                          */\r\n                        if(lRefreshIcon.click)lRefreshIcon.parentElement.click();\r\n                        else lRefreshIcon.parentElement.onclick();\r\n                        \r\n                        /* перебираем файлы левой панели\r\n                         * в поисках подсвеченого файла\r\n                         */\r\n                        var lLeft=document.getElementById('left');\r\n                        if(lLeft){\r\n                            /* перебираем все файлы в панели */\r\n                            var lLi=lLeft.getElementsByTagName('li');\r\n                            lCurrentFile.className='';\r\n                            /* начинаем с 2-ух, по скольку\r\n                             * 0 - это путь\r\n                             * 1 - это заголовок файловой таблицы\r\n                             */\r\n                            for(var i=2;i<lLi.length;i++){\r\n                                lName=lLi[i].getElementsByTagName('a')[0].innerText;\r\n                                if(lSelectedName.length===lName.length &&\r\n                                    !lSelectedName.indexOf(lName)){\r\n                                        lLi[i].className=CloudCommander.CURRENT_FILE;\r\n                                        break;\r\n                                }\r\n                            }                            \r\n                        }\r\n                                    \r\n                        event.preventDefault();//запрет на дальнейшее действие\r\n                    }\r\n                }\r\n                /* если нажали <ctrl>+d чистим кэш */\r\n                else if(event.keyCode===68 &&\r\n                    event.ctrlKey){\r\n                        console.log('<ctrl>+d pressed');\r\n                        console.log('clearing cache...');\r\n                        console.log('press <alt>+q to remove all key-handlers');\r\n    \r\n                        var lClearCache=document.getElementById('clear-cache');\r\n                        if(lClearCache && lClearCache.onclick)lClearCache.onclick();\r\n                        \r\n                        event.preventDefault();//запрет на дальнейшее действие\r\n                }\r\n                /* если нажали <alt>+q \r\n                 * убираем все обработчики\r\n                 * нажатий клавиш\r\n                 */             \r\n                else if(event.keyCode===81 &&\r\n                    event.altKey){\r\n                        //document.removeEventListener('keydown', key_event,false);\r\n                        console.log('<alt>+q pressed');\r\n                        console.log('<ctrl>+r reload key-handerl - removed');\r\n                        console.log('<ctrl>+s clear cache key-handler - removed');\r\n                        console.log('press <alt>+s to to set them');\r\n                        \r\n                        /* обработчик нажатий клавиш снят*/\r\n                        CloudCommander.keyBinded=false;\r\n                }\r\n            }\r\n            /* если нажали <alt>+s \r\n             * устанавливаем все обработчики\r\n             * нажатий клавиш\r\n             */             \r\n            else if(event.keyCode===83 &&\r\n                event.altKey){\r\n                    /*\r\n                        document.addEventListener('keydown', key_event,false);\r\n                    */\r\n                    /* обрабатываем нажатия на клавиши*/\r\n                    CloudCommander.keyBinded=true;\r\n                    \r\n                    console.log('<alt>+s pressed');\r\n                    console.log('<ctrl>+r reload key-handerl - set');\r\n                    console.log('<ctrl>+s clear cache key-handler - set');\r\n                    console.log('press <alt>+q to remove them');\r\n            }            \r\n            \r\n         return false;\r\n    };\r\n    /* добавляем обработчик клавишь */\r\n    if(document.addEventListener)\r\n        document.addEventListener('keydown', key_event,false);\r\n    else document.onkeypress=key_event;\r\n    /* клавиши назначены*/\r\n    CloudCommander.keyBinded=true;\r\n});"]],"start1":0,"start2":0,"length1":0,"length2":12682}]],"length":12682}
